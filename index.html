<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Monitor dinámico embebido</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      font-family: system-ui, sans-serif;
      background: #020617;
      color: #e5e7eb;
    }
    #topbar {
      box-sizing: border-box;
      width: 100%;
      padding: 8px 14px;
      font-size: 13px;
      background: #020617;
      border-bottom: 1px solid rgba(148,163,184,0.4);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }
    #status {
      color: #cbd5f5;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    #fallback-link {
      font-size: 12px;
      color: #22c55e;
      text-decoration: none;
      font-weight: 600;
    }
    #fallback-link:hover {
      text-decoration: underline;
    }
    #frame-container {
      width: 100%;
      height: calc(100% - 40px);
    }
    iframe {
      border: none;
      width: 100%;
      height: 100%;
      background: #020617;
    }
  </style>
</head>
<body>
  <div id="topbar">
    <div id="status">Consultando enlace desde <code>enlace.txt</code>…</div>
    <a id="fallback-link" href="#" target="_blank" rel="noopener noreferrer" style="display:none;">
      Abrir en pestaña nueva
    </a>
  </div>

  <div id="frame-container">
    <iframe id="viewer" src=""></iframe>
  </div>

  <script>
    // Ruta RELATIVA: el archivo enlace.txt está junto a index.html
    const RAW_URL = "enlace.txt";

    async function cargarEnlace() {
      const status = document.getElementById("status");
      const iframe = document.getElementById("viewer");
      const fallbackLink = document.getElementById("fallback-link");

      try {
        status.textContent = "Leyendo enlace desde enlace.txt…";

        const resp = await fetch(RAW_URL, { cache: "no-store" });
        if (!resp.ok) {
          throw new Error("No se pudo leer enlace.txt (" + resp.status + ")");
        }

        let text = await resp.text();
        let url = text.trim().split(/\s+/)[0];

        if (!url || !url.startsWith("http")) {
          throw new Error("El contenido de enlace.txt no parece una URL válida");
        }

        status.textContent = "Mostrando: " + url;
        fallbackLink.style.display = "inline";
        fallbackLink.href = url;

        // Mostrar la página del monitor dentro del iframe
        iframe.src = url;

      } catch (err) {
        console.error(err);
        status.textContent = "Error: " + err.message;
        fallbackLink.style.display = "none";
        iframe.src = "about:blank";
      }
    }

    window.addEventListener("load", cargarEnlace);
  </script>
</body>
</html>
